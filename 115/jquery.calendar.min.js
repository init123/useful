function zCalendar(e,a){var d=this;var b=$(e);this.Table=b.find("table:first");this.Arrow=b.find("div:first");this.Hide=b.find("input:first");this.Show=b.find("p:first");this.cfg={txt:["年","月","已预约时间：","可预约","不可预约"],cls:["z-on","z-dis","z-at"],iw:true,sp:5,fw:0,num:3,tp:true,ls:[],mt:false,has:[],err:false,jump:false,msg:"",is67:true,max:20301231};this.cfg.ls.sort();for(var c in a){this.cfg[c]=a[c]}this.rand=(Math.random()-Math.random()+"").substr(3,5);this.thenD=(function(){var n=d.cfg.ls[0];if(n===undefined||n==""){var q=new Date(),l=q.getMonth()+1,p=q.getDate();if(l<10){l="0"+l}if(p<10){p="0"+p}n=q.getFullYear()+""+l+""+p}var i=n.slice(0,4),o=n.slice(4,6),h=n.slice(6,8),j=new Date(i+"/"+o+"/"+h).getDay(),k=new Date(parseInt(i,10),(parseInt(o,10)-1),parseInt(h,10),8,30).getTime();if(j==0){j=7}return[i,o,h,j,k]})();if(d.cfg.has.length>0){d.Hide.val(d.cfg.has.join("||"))}this.parseRange=(function(){if(d.cfg.ls[0]===""||d.cfg.ls[0]===undefined){d.cfg.mt=false;d.cfg.has=[];d.cfg.ls=false;d.note(d.cfg.msg);return false}d.cfg.ls.sort();if(d.cfg.tp){var l=d.thenD[0]+""+d.thenD[1]+""+d.thenD[2],q=d.cfg.ls[0],u=d.cfg.ls[1],w={};if(q<=l){q=l}if(u<=l){u=l}if(u>d.cfg.max){u=d.cfg.max+""}var t=q.substr(0,6),m=u.substr(0,6),h=q.substr(6),s=u.substr(6);if(t.substr(0,4)==m.substr(0,4)){t=Math.floor(t),m=Math.floor(m);for(;t<=m;t++){var B=q.indexOf(t)===-1?1:h;var x=u.indexOf(t)===-1?"x":s;w[t]=[B,x]}}else{var k=d.parseMonth(t,m),x=0,A=k.length;for(;x<A;x++){w[k[x]]=[(x==0?h:1),(x==(A-1)?s:"x")]}}}else{var l=d.thenD[0]+""+(d.thenD[1]<10?"0"+d.thenD[1]:d.thenD[1])+""+(d.thenD[2]<10?"0"+d.thenD[2]:d.thenD[2]),r=d.cfg.ls,w={};var m=r.length;if(m>0){for(var t=0;t<m;t++){if(r[t]>=l){var p=r[t].substr(0,6),o=r[t].substr(6);if(w[p]===undefined){w[p]={}}w[p][o]=Math.floor(o)}}}if(d.cfg.jump===false){var v=d.parseMonth(r[0],r[m-1]);for(var j in v){if(w[v[j]]===undefined){w[v[j]]={}}}}}return w})();this.disableRange=(function(){var q=d.thenD,l=q[0],k=parseInt(q[1],10),j=parseInt(q[2],10);k=k<10?"0"+k:k;j=j<10?"0"+j:j;var r=0;if(d.cfg.iw===true){var m=d.cfg.sp,n=d.thenD[3];if(m==5){switch(true){case (n<6):r=2;break;case (n>6):r=3;break;default:r=4}}else{if(m==4){switch(true){case (n<2):r=0;break;case (n>6):r=1;break;default:r=2}}else{if(m==3){switch(true){case (n<3):r=0;break;case (n>6):r=1;break;default:r=2}}else{if(m==2){switch(true){case (n<4):r=0;break;case (n>6):r=1;break;default:r=2}}else{if(m==1){switch(true){case (n<5):r=0;break;case (n>6):r=1;break;default:r=2}}}}}}}var s=q[4]+(d.cfg.sp-1+r)*24*60*60*1000;var i=new Date(s);var o=[i.getFullYear(),(i.getMonth()+1),i.getDate()],h=o[0],u=o[1],t=o[2];u=u<10?"0"+u:u;t=t<10?"0"+t:t;var p=[];if(l+""+k==h+""+u){p[l+""+k]=[Math.floor(j),Math.floor(t)]}else{p[l+""+k]=[Math.floor(j),"x"];p[h+""+u]=[1,Math.floor(t)]}return p})();this.storage="";this.dinfo=[];var f=this.thenD[0],g=this.thenD[1];if(this.cfg.mt!==false){f=this.cfg.mt[0],g=this.cfg.mt[1]}this.init(f,g);this.Table.off("click","td."+this.cfg.cls[0]).on("click","td."+this.cfg.cls[0],function(){d.dayClick($(this),d);return false});this.Arrow.off("click","a."+this.cfg.cls[0]).on("click","a."+this.cfg.cls[0],function(){var h=$(this).attr("data-v");if(h){d.keepon(h.substr(0,4),h.substr(4))}return false})}zCalendar.prototype={init:function(c,d){if(this.cfg.has.length>0){var b=this.cfg.has,e="";for(var a in b){e+="|"+b[a]+"|"}this.storage=e;this.setAt(c,d)}this.keepon(c,d)},keepon:function(a,b){this.arrow(a,b);this.Table.html(this.thead()+this.tbody(a,b));this.setOn(a,b);this.setAt(a,b);if(this.cfg.ls!==false){this.note()}},dayClick:function(d,c){var b=d.attr("data-v");if(d.hasClass(c.cfg.cls[2])){d.removeClass(c.cfg.cls[2]);c.storage=c.storage.replace("|"+b+"|","");c.note()}else{if(c.cfg.num===1){c.Table.find("td").removeClass(c.cfg.cls[2]);d.addClass(c.cfg.cls[2]);c.storage="|"+b+"|";c.note()}else{var a=c.isEnough();if(a===false){d.addClass(c.cfg.cls[2]);c.storage+="|"+b+"|";c.note()}else{if(c.cfg.err===false){console.log(a)}else{c.cfg.err.call(null,c.cfg.num)}}}}c.Hide.val(c.storage.replace(/(^\||\|$)/g,""))},parseMonth:function(o,g){var m=o.substr(0,4),l=g.substr(0,4),c=o.substr(4,2),h=g.substr(4,2);var f=[],n=0,k=l-m;for(;m<=l;m++){var e=1,d=12;if(n==0){e=Math.floor(c)}if(n==k){d=Math.floor(h)}for(;e<=d;e++){f.push(m+""+(e<10?"0"+e:e))}n++}return f},arrDate:function(){var a=[];if(this.storage.indexOf("||")!==-1){a=this.storage.replace(/(^\||\|$)/g,"").split("||")}else{if(this.storage.indexOf("|")!==-1){a=this.storage.replace(/\|/g,"").split(/\s+/)}}return a},isEnough:function(){if(this.storage){var a=this.storage.match(/\|/g).length/2;return a>(this.cfg.num-1)?"Limit reached !":false}else{return false}},setOn:function(l,w){var a=this.parseRange[l+""+w];if(a===undefined){return false}if(this.cfg.tp){var u=this.dinfo;if(a[1]==="x"){a[1]=u[1]}this.Table.find("td").removeClass(this.cfg.cls[0]);var r=Math.floor(a[0]),p=Math.floor(a[1]),v=[];if(this.cfg.iw){var q=1;if(u[0]<0){q=Math.abs(u[0])+1}else{if(u[0]>0){q=u[0]-1}}if(this.cfg.fw!==0){q+=1
}if(r!==1){q=q+(r%7)-1}for(;r<=p;r++){if(q%7!=0&&q%7!=6){v.push("#j-"+this.rand+"-"+r)}q++}}else{for(;r<=p;r++){v.push("#j-"+this.rand+"-"+r)}}}else{var v=[];for(var q in a){v.push("#j-"+this.rand+"-"+a[q])}}$(v.join()).addClass(this.cfg.cls[0]).append($("<i>"+this.cfg.txt[3]+"</i>"));if(this.cfg.tp){var s=this.disableRange[l+""+w];if(s!==undefined){var m=s[0],e=s[1],j=[];if(e==="x"){e=a[1]}for(;m<=e;m++){j.push("#j-"+this.rand+"-"+m)}}var h=this.cfg.cls[0],c=this.cfg.txt[3],o=this.cfg.txt[4],g=false;if(j!==undefined){$(j.join()).filter(function(){return $(this).hasClass(h)}).removeClass(this.cfg.cls[0]).each(function(){var d=$(this).html().replace(c,o);$(this).html(d)})}else{g=true}if(this.cfg.is67){var b=$("td.z-on:first");if(b.length>0){var t=1,v=[];if(g===false){t=parseInt(b.attr("data-v").substring(6),10),v=[]}if(a[1]==="x"){a[1]=u[1]}for(;t<=a[1];t++){var f="#j-"+this.rand+"-"+t;if(!$(f).hasClass("z-on")){v.push(f)}}$(v.join()).addClass(this.cfg.cls[0]).append($("<i>"+this.cfg.txt[3]+"</i>"))}}}},setAt:function(c,d){var b=this.arrDate(),e=[];if(b.length>0){for(var a in b){if(b[a].substr(0,6)===c+""+d){e.push("#j-"+this.rand+"-"+Math.floor(b[a].substr(6)))}}if(e.length>0){$(e.join()).addClass("z-at")}}},arrSiblings:function(b,f){if(f[b]===undefined){f[b]={}}var e=[],c=["",""];var d=0,g=1;for(var a in f){e.push(a);if(a==b){d=g}g++}if(d>1){c[0]=e[d-2]}if(e[d]!==undefined){c[1]=e[d]}return c},arrow:function(b,f){var c=this.arrSiblings(b+""+f,this.parseRange);var a="<span>"+b+this.cfg.txt[0]+" "+parseInt(f,10)+this.cfg.txt[1]+"</span>",e='<a href="javascript:void(0);" class="lft">&nbsp;</a>',d='<a href="javascript:void(0);" class="rgt">&nbsp;</a>';if(c[0]!=""){e='<a href="javascript:void(0);" class="lft z-on" data-v="'+c[0]+'">'+parseInt(c[0].substr(4),10)+"月</a>"}if(c[1]!=""){d='<a href="javascript:void(0);" class="rgt z-on" data-v="'+c[1]+'">'+parseInt(c[1].substr(4),10)+"月</a>"}this.Arrow.html(e+a+d)},thead:function(){var d=["日","一","二","三","四","五","六"],c=[];if(this.cfg.fw!==0){var e=d.shift();d.push(e)}for(var b in d){var a=(d[b]=="日"||d[b]=="六")?' class="z-sp"':"";c[b]="<td"+a+">"+d[b]+"</td>"}return"<thead><tr>"+c.join("")+"</tr></thead>"},tbody:function(f,b){var g=this._compute(f,b),j="",c=1;this.dinfo=g;for(var i=g[0];i<=g[2];i++){var h="",d="&nbsp;",a="";if(i>0&&i<=g[1]){d=i;h=' id="j-'+this.rand+"-"+i+'"';a=' data-v="'+f+b+(i<10?"0"+i:i)+'"'}j+="<td"+h+a+">"+d+"</td>";if(c%7==0){j+="</tr><tr>"}c++}return"<tbody><tr>"+j+"</tr></tbody>"},note:function(f){if(f===undefined){var d=this.arrDate(),e=[];if(d.length>0){for(var c in d){var b=d[c];e.push(b.substr(0,4)+"年"+b.substr(4,2)+"月"+b.substr(6)+"日")}}var a=e.length===0?"":this.cfg.txt[2]+"<span>"+e.join("<br />")+"</span>"}else{var a="<span>"+f+"</span>"}this.Show.html(a)},_compute:function(c,e){var g=new Date(c,e,0),a=g.getDate(),b,f=[];g.setDate(1);b=g.getDay();if(this.cfg.fw===0){f[0]=0-(b-1);f[1]=(b==0?a:(Math.abs(f[0])+1+a))%7}else{if(b==0){b=7}f[0]=0-(b-2);f[1]=(b==1?a:Math.abs(f[0])+1+a)%7}if(f[1]!=0){f[1]=7-f[1]}return[f[0],a,(a+f[1])]}};